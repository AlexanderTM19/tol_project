{% extends 'core/conductor.html' %}
{% load static %}

{% block title %}Fichero Taxi Oficial{% endblock %}
{% block extra_css %}
<style>
	.card-custom-table {
		border-radius: 1.5rem;
		box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08), 0 1.5px 4px rgba(0, 0, 0, 0.04);
		transition: transform 0.25s cubic-bezier(.4, 2, .6, 1), box-shadow 0.25s;
		background: #fff;
		border: none;
		min-width: 100%;
		max-width: 100%;
		min-height: 220px;
		height: 100%;
		font-size: 1.15rem;
		padding: 1.2rem 1.5rem;
		margin-bottom: 0.5rem;
	}

	.card-custom-table:hover {
		transform: translateY(-8px) scale(1.03);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), 0 3px 8px rgba(0, 0, 0, 0.08);
	}
	.card-custom {
		border-radius: 1.5rem;
		box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08), 0 1.5px 4px rgba(0, 0, 0, 0.04);
		transition: transform 0.25s cubic-bezier(.4, 2, .6, 1), box-shadow 0.25s;
		background: #fff;
		border: none;
		min-width: 340px;
		max-width: 420px;
		min-height: 220px;
		height: 100%;
		font-size: 1.15rem;
		padding: 1.2rem 1.5rem;
		margin-bottom: 0.5rem;
	}

	.card-custom:hover {
		transform: translateY(-8px) scale(1.03);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16), 0 3px 8px rgba(0, 0, 0, 0.08);
	}

	.circle-badge {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		font-weight: bold;
		color: #fff;
		font-size: 1.1rem;
		margin: 6px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.10);
		transition: background 0.3s, transform 0.2s;
		cursor: pointer;
	}

	.circle-badge.blue {
		background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
	}

	.circle-badge.blue:hover {
		background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
		transform: scale(1.12);
	}

	.circle-badge.red {
		background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
	}

	.circle-badge.red:hover {
		background: linear-gradient(135deg, #ff4b2b 0%, #ff416c 100%);
		transform: scale(1.12);
	}

	.fade-in {
		animation: fadeInUp 0.8s cubic-bezier(.4, 2, .6, 1);
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.section-title {
		font-weight: 700;
		font-size: 2rem;
		margin-bottom: 1.5rem;
		color: #1e3c72;
		letter-spacing: 1px;
		text-align: left;
	}

	.scroll-x-cards {
		overflow-x: auto;
		white-space: nowrap;
		display: flex;
		flex-wrap: nowrap;
		gap: 1.2rem;
		padding-bottom: 0.5rem;
	}

	.scroll-x-cards .card-custom {
		display: inline-block;
		min-width: 340px;
		max-width: 420px;
		min-height: 220px;
		height: 100%;
		margin-right: 0;
	}

	@media (max-width: 991px) {
		.scroll-x-cards {
			gap: 0.7rem;
		}
	}

	.card-title {
		font-size: 1.1rem;
		font-weight: 600;
		color: #2a5298;
	}

	.card-text {
		color: #444;
		font-size: 1rem;
	}

	.card-group-custom {
		gap: 1.2rem;
	}

	@media (max-width: 991px) {
		.card-group-custom {
			flex-direction: column;
		}
	}

	.scrollable-x {
		overflow-x: auto;
		white-space: nowrap;
		padding-bottom: 0.5rem;
	}
</style>
{% endblock %}

<style>
	.modern-table {
		border-radius: 1rem;
		overflow: hidden;
		background: #f8fafc;
		box-shadow: 0 2px 12px rgba(30, 60, 114, 0.07);
	}

	.modern-table th,
	.modern-table td {
		border: none;
		padding: 0.85rem 1rem;
		vertical-align: middle;
	}

	.modern-table thead th {
		background: #eaf1fb;
		font-weight: 700;
		letter-spacing: 0.5px;
		font-size: 1.05rem;
	}

	.modern-table tbody tr {
		transition: background 0.2s;
	}

	.modern-table tbody tr:hover {
		background: #f1f7ff;
	}

	.modern-table .badge {
		border-radius: 0.7rem;
		padding: 0.5em 0.9em;
		font-weight: 600;
	}
</style>

{% block content %}
<div class="container-fluid py-4 fade-in">
	<div class="row mb-4">
		<div class="col-12 px-2 px-md-4">
			<h2 class="section-title">Fichero Taxi</h2>
			<div class="scroll-x-cards mb-3">
				<div class="card card-custom">
					<div class="card-body">
						<div class="card-title mb-2">Conductor que realiza último servicio</div>
						
						{% if ultimo_conductor_servicio and ultima_reserva_realizada %}
							<div class="card-text">
								
								<strong>N° Conductor:</strong> 
								<span class="fw-bold">{{ ultimo_conductor_servicio.Nro_ficha }}</span>
								<br>
								
								<strong>Nombre:</strong> 
								{{ ultimo_conductor_servicio.usuario.Nombres }} {{ ultimo_conductor_servicio.usuario.Apellidos }}
								<br>
								
								<strong>Fecha y Hora última Servicio:</strong> 
								{{ ultima_reserva_realizada.Fecha|date:"d-m-Y" }} | {{ ultima_reserva_realizada.Hora|time:"H:i" }}
							</div>
						{% else %}
							<div class="card-text text-muted small text-center p-4">
								<i class="fas fa-exclamation-circle mb-2" style="font-size: 1.5rem;"></i>
								<p class="mb-0 text-wrap w-100">
									No hay servicios finalizados recientemente para mostrar.
								</p>
							</div>
						{% endif %}
						
					</div>
				</div>
				<div class="card card-custom">
					<div class="card-body">
						<div class="card-title mb-2">Conductor que lleva más servicios</div>
						<div class="card-text">
							<strong>N°:</strong> 5<br>
							<strong>Nombre de usuario:</strong> René González<br>
							<strong>Cantidad de servicios:</strong> 159
						</div>
					</div>
				</div>
				<div class="card card-custom">
					<div class="card-body">
						<div class="card-title mb-2">Conductor que lleva menos servicios</div>
						<div class="card-text">
							<strong>N°:</strong> 44<br>
							<strong>Nombre de usuario:</strong> Gaby Patricia<br>
							<strong>Cantidad de servicios:</strong> 2
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-12 col-lg-4 px-2 px-md-4">
			<div class="card card-custom p-3 mb-3 fade-in h-100">
				<div class="mb-2 text-center fw-bold" style="font-size:1.2rem; color:#2a5298;">Fichero de Conductores
				</div>
				<div class="d-flex flex-wrap justify-content-center align-items-center scrollable-x mb-2">
					{% for n in Lista_conductores %}
						{% if n.estado == 'DISPONIBLE' %}
							<span class="circle-badge blue" title="Conductor {{n}}">{{ n.Nro_ficha }}</span>
						{%endif%}
					{% endfor %}
				</div>
				<hr>
				<div class="mb-2 text-center fw-bold" style="font-size:1.1rem; color:#ff416c;">Conductores Suspendidos
				</div>
				<div class="d-flex flex-wrap justify-content-center align-items-center scrollable-x">
					{% for n in Lista_conductores %}
						{% if n.estado == 'SUSPENDIDO' %}
							<span class="circle-badge red" title="Suspendido {{n}}">{{ n.Nro_ficha }}</span>
						{%endif%}
					{% endfor %}
				</div>
			</div>
		</div>
		<div class="col-12 col-lg-8 px-2 px-md-4">
			<div class="card card-custom-table p-3 mb-3 fade-in h-100" style="min-height:320px; width:100%;">
				<div class="d-flex justify-content-between align-items-center mb-2">
					<div class="fw-bold" style="font-size:1.2rem; color:#1e3c72;">Detalle de Conductores</div>
					<div class="text-muted" style="font-size:1rem;">Total: <span id="total-filas">{{ total_filas }}</span></div>
				</div>
				<div class="table-responsive" style="width:100%;">
					<table class="table table-hover align-middle modern-table" style="min-width:100%; width:100%;">
						<thead>
							<tr>
								<th style="color:#2a5298;">N° Ficha</th>
								<th style="color:#2a5298;">Usuario</th>
								<th style="color:#2a5298;">Cantidad de servicios</th>
								<th style="color:#2a5298;">Activo?</th>
							</tr>
						</thead>
						<tbody id="tabla-conductores-body">
							{% for conductor in Lista_conductores %}
							<tr class="conductores-row" style="display: none;">
								<td>
									{% if conductor.estado == 'DISPONIBLE' %}
										<span class="circle-badge bg-success" style="font-size:1rem;">{{ conductor.Nro_ficha }}</span>
										
									{% elif conductor.estado == 'OCUPADO' %}
										<span class="circle-badge bg-primary" style="font-size:1rem;">{{ conductor.Nro_ficha }}</span>
										
									{% elif conductor.estado == 'INACTIVO' or conductor.estado == 'SUSPENDIDO' %}
										<span class="circle-badge bg-danger" style="font-size:1rem;">{{ conductor.Nro_ficha }}</span>
										
									{% else %}
										<span class="circle-badge bg-secondary" style="font-size:1rem;">{{ conductor.Nro_ficha }}</span>
										
									{% endif %}
								</td>
								<td>{{ conductor.usuario.Nombres }}  {{ conductor.usuario.Apellidos }}</td>
                            	<td>
									<span class="badge bg-info text-dark" style="font-size:1rem;">
										{{ conductor.total_viajes_realizados }}
									</span>
								</td>
								<td>
									{{ conductor.get_estado_display }}
								</td>
								
								{% empty %}
								<tr>
									<td colspan="5" class="text-center text-muted">No hay datos de conductores.</td>
								</tr>
								
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<!-- Paginación moderna -->
				<nav aria-label="Paginación de conductores" class="d-flex justify-content-end">
					<ul class="pagination pagination-rounded" id="paginacionConductores" style="margin-bottom:0;">
						<!-- Se llenará por JS -->
					</ul>
				</nav>
				<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
				<script>
					// Paginación moderna para la tabla de conductores
					document.addEventListener('DOMContentLoaded', function() {
						const filas = Array.from(document.querySelectorAll('.conductores-row'));
						const filasPorPagina = 8;
						let paginaActual = 1;
						const totalPaginas = Math.ceil(filas.length / filasPorPagina);
						const paginacion = document.getElementById('paginacionConductores');

						function mostrarPagina(pagina) {
							filas.forEach((fila, idx) => {
								fila.style.display = (idx >= (pagina-1)*filasPorPagina && idx < pagina*filasPorPagina) ? '' : 'none';
							});
							renderizarPaginacion(pagina);
						}

						function renderizarPaginacion(pagina) {
							paginacion.innerHTML = '';
							if (totalPaginas <= 1) return;
							// Botón anterior
							paginacion.innerHTML += `<li class="page-item${pagina === 1 ? ' disabled' : ''}"><a class="page-link" href="#" tabindex="-1" aria-disabled="${pagina === 1}" onclick="return false;">&laquo;</a></li>`;
							// Números de página
							for (let i = 1; i <= totalPaginas; i++) {
								paginacion.innerHTML += `<li class="page-item${i === pagina ? ' active' : ''}"><a class="page-link" href="#">${i}</a></li>`;
							}
							// Botón siguiente
							paginacion.innerHTML += `<li class="page-item${pagina === totalPaginas ? ' disabled' : ''}"><a class="page-link" href="#" aria-disabled="${pagina === totalPaginas}" onclick="return false;">&raquo;</a></li>`;

							// Listeners
							Array.from(paginacion.querySelectorAll('a.page-link')).forEach((el, idx) => {
								el.onclick = function(e) {
									e.preventDefault();
									if (idx === 0 && pagina > 1) mostrarPagina(pagina-1);
									else if (idx === totalPaginas+1 && pagina < totalPaginas) mostrarPagina(pagina+1);
									else if (idx > 0 && idx <= totalPaginas) mostrarPagina(idx);
								};
							});
						}

						mostrarPagina(paginaActual);
					});
				</script>
			</div>
		</div>
	</div>
</div>
{% endblock %}